<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Dashboard</title>
    <meta name="description" content="Real-time stock signal analyzer with Telegram monitoring and BSE/NSE correlation">
    <link rel="stylesheet" href="/static/styles.css?v=5">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üìà</span>
                <h1>StockPulse</h1>
            </div>

            <nav class="nav">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <span class="nav-icon">üè†</span>
                    Dashboard
                </a>
                <a href="#" class="nav-item" data-section="overview">
                    <span class="nav-icon">üåê</span>
                    Market Overview
                </a>
                <a href="#" class="nav-item" data-section="watchlist">
                    <span class="nav-icon">‚≠ê</span>
                    Watchlist
                </a>
                <a href="#" class="nav-item" data-section="messages">
                    <span class="nav-icon">üí¨</span>
                    Signals
                </a>
                <a href="#" class="nav-item" data-section="news">
                    <span class="nav-icon">üì∞</span>
                    Market News
                </a>

                <div class="nav-item" data-section="research">
                    <span class="material-icons nav-icon-material">science</span>
                    <span>Research Console</span>
                </div>
                <div class="nav-item" data-section="allstar">
                    <span class="material-icons nav-icon-material">star</span>
                    <span>All Star Picks</span>
                </div>
                <div class="nav-item" data-section="exittracker">
                    <span class="material-icons nav-icon-material">exit_to_app</span>
                    <span>Exit Tracker</span>
                </div>
                <div class="nav-item" data-section="screener">
                    <span class="material-icons nav-icon-material">filter_alt</span>
                    <span>Stock Screener</span>
                </div>
                <div class="nav-item" data-section="allscreens">
                    <span class="material-icons nav-icon-material">local_fire_department</span>
                    <span>All Screens</span>
                </div>

                <!-- Quant Lab Section -->
                <div class="nav-section-divider"
                    style="margin-top: 16px; padding: 8px 16px; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">
                    Quant Lab</div>
                <div class="nav-item" data-section="patterns">
                    <span class="material-icons nav-icon-material">candlestick_chart</span>
                    <span>Pattern Scout</span>
                </div>
                <div class="nav-item" data-section="qvm">
                    <span class="material-icons nav-icon-material">radar</span>
                    <span>QVM Engine</span>
                </div>
                <div class="nav-item" data-section="concall">
                    <span class="material-icons nav-icon-material">description</span>
                    <span>Con-Call Analyst</span>
                </div>
                <div class="nav-item" data-section="mood">
                    <span class="material-icons nav-icon-material">mood</span>
                    <span>Market Mood</span>
                </div>

                <div class="nav-item" data-section="ai">
                    <span class="material-icons nav-icon-material">smart_toy</span>
                    <span>AI Assistant</span>
                </div>
                <div class="nav-item" data-section="sources">
                    <span class="material-icons nav-icon-material">broadcast_on_personal</span>
                    <span>Telegram Sources</span>
                </div>
                <div class="nav-item" data-section="settings">
                    <span class="material-icons nav-icon-material">settings</span>
                    <span>Settings</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <!-- System Controls moved to Settings Page -->
                <div class="user-info" style="display: none;">
                    <!-- Hidden as per user request -->
                </div>
            </div>

            <div class="telegram-status" id="telegramStatus">
                <span class="status-dot disconnected"></span>
                <span>Telegram: Disconnected</span>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header with Calendar Filter -->
            <header class="header">
                <div class="header-left">
                    <h2 id="pageGreeting">Hello, Trader üëã</h2>
                    <p class="greeting-subtitle">What would you like to analyze today?</p>
                </div>

                <div class="header-center">
                    <!-- Unified Search & Command Bar -->
                    <div class="omnibar-container" id="omnibarContainer">
                        <span class="omnibar-icon">‚ú®</span>
                        <input type="text" class="omnibar-input" id="omnibarInput"
                            placeholder="Ask any question or type a stock symbol (e.g. RELIANCE)..." autocomplete="off"
                            list="stockSuggestions">
                        <datalist id="stockSuggestions">
                            <!-- Populated by JS -->
                        </datalist>
                        <div class="omnibar-actions">
                            <span class="omnibar-shortcut">‚åòK</span>
                        </div>
                        <div class="search-results-dropdown" id="omnibarResults"></div>
                    </div>
                </div>

                <div class="header-right">
                    <!-- Icons removed as per request -->
                </div>
            </header>

            <!-- Dashboard Section -->
            <section class="section" id="dashboard-section">
                <!-- üöÄ Absolute Picks - High Growth Potential -->
                <div class="absolute-section" id="absoluteSection">
                    <div class="section-header">
                        <div class="header-main-group">
                            <h3 class="absolute-title">üöÄ Absolute Picks - High Growth Potential</h3>
                            <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                        </div>
                    </div>
                    <div class="absolute-container">
                        <div class="absolute-picks" id="absolutePicks">
                            <div class="empty-state"><span class="loading"></span>
                                <p>Analyzing high potential stocks...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚≠ê All Star Picks - Top 10 for Next Day -->
                <div class="allstar-section" id="allstarSection">
                    <div class="section-header">
                        <div class="header-main-group">
                            <h3>‚≠ê All Star Picks - Today's Top 10</h3>
                            <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                        </div>
                        <div id="allstarTimer" class="refresh-timer">Refreshing in: 3:30 PM</div>
                    </div>
                    <div class="allstar-container">
                        <div class="allstar-picks" id="allstarPicks">
                            <div class="empty-state"><span class="loading"></span>
                                <p>Loading All Star picks...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- üìà Live Performance Tracker (Trading Hours Only) -->
                <div class="performance-section" id="performanceSection" style="display: none;">
                    <div class="section-header">
                        <div class="header-main-group">
                            <h3>üìà Today's Pick Performance<span class="live-indicator">üî¥ LIVE</span></h3>
                        </div>
                    </div>
                    <div class="performance-grid" id="performanceGrid">
                        <!-- Cards populated by JS -->
                    </div>
                </div>

                <!-- Market Indices -->
                <div class="indices-container">
                    <button class="scroll-btn left" onclick="scrollContainer('indicesRow', -400)">‚Äπ</button>
                    <div class="indices-row" id="indicesRow">
                        <div class="index-card nifty" id="niftyCard">
                            <div class="index-name">NIFTY 50</div>
                            <div class="index-value">--</div>
                            <div class="index-change">--</div>
                        </div>
                        <div class="index-card sensex" id="sensexCard">
                            <div class="index-name">SENSEX</div>
                            <div class="index-value">--</div>
                            <div class="index-change">--</div>
                        </div>
                        <div class="index-card banknifty" id="bankniftyCard">
                            <div class="index-name">BANK NIFTY</div>
                            <div class="index-value">--</div>
                            <div class="index-change">--</div>
                        </div>
                    </div>
                    <button class="scroll-btn right" onclick="scrollContainer('indicesRow', 400)">‚Ä∫</button>
                </div>

                <!-- üì° Live Signal Feed -->
                <div class="live-signal-section" style="margin-bottom: 24px;">
                    <div class="section-header"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">
                            üì° Live Signal Feed
                            <span id="liveSignalCount"
                                style="font-size: 12px; background: var(--accent-primary); color: #fff; padding: 2px 8px; border-radius: 99px;">0</span>
                        </h3>
                        <span id="liveSignalUpdated" style="font-size: 11px; color: var(--text-muted);">--</span>
                    </div>
                    <div id="liveSignalFeed" class="live-signal-feed"
                        style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px;">
                        <div class="empty-state"
                            style="flex: 1; text-align: center; padding: 24px; color: var(--text-muted);">
                            <span>‚è≥</span>
                            <p>Waiting for signals...</p>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-icon">üí¨</div>
                        <div class="stat-info">
                            <div class="stat-value" id="statMessages">0</div>
                            <div class="stat-label">Signals Today</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì∞</div>
                        <div class="stat-info">
                            <div class="stat-value" id="statNews">0</div>
                            <div class="stat-label">News Articles</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì°</div>
                        <div class="stat-info">
                            <div class="stat-value" id="statSources">0</div>
                            <div class="stat-label">Active Sources</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="statRecommendations">0</div>
                            <div class="stat-label">Recommendations</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="actions-row">
                    <button class="btn btn-action" id="fetchNewsBtn">
                        <span>üì∞</span> Fetch News
                    </button>
                    <button class="btn btn-action" id="fetchPricesBtn">
                        <span>üíπ</span> Update Prices
                    </button>
                    <button class="btn btn-action btn-primary" id="analyzeBtn">
                        <span>üîç</span> Analyze & Recommend
                    </button>

                    <div class="auto-refresh-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoRefreshToggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Auto (32s)</span>
                    </div>
                </div>

                <!-- Recommendations Preview -->
                <div class="recommendations-preview">
                    <h3>üìä Latest Recommendations</h3>
                    <div class="timeframe-tabs">
                        <button class="timeframe-tab active" data-tf="next_day">Next Day</button>
                        <button class="timeframe-tab" data-tf="next_week">Next Week</button>
                        <button class="timeframe-tab" data-tf="next_month">Next Month</button>
                        <button class="timeframe-tab" data-tf="1yr">1 Year</button>
                        <button class="timeframe-tab" data-tf="1yr">1 Year</button>
                    </div>
                    <div class="recommendations-grid" id="recommendationsGrid">
                        <div class="empty-state">
                            <span>üîç</span>
                            <p>Click "Analyze & Recommend" to generate recommendations</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Market Overview Section -->
            <section class="section hidden" id="overview-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üåê Market Overview (24hr News-Based)</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                    </div>
                    <button class="btn btn-primary" id="analyzeMarketBtn">üîç Analyze Market</button>
                </div>

                <div class="overview-grid" id="overviewContent">
                    <div class="empty-state">
                        <span>üåê</span>
                        <p>Loading market overview...</p>
                    </div>
                </div>
            </section>

            <!-- Watchlist Section -->
            <section class="section hidden" id="watchlist-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>‚≠ê My Watchlist</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                    </div>
                    <button class="btn btn-primary" id="addWatchlistBtn">+ Add Stock</button>
                </div>

                <div class="watchlist-grid" id="watchlistGrid">
                    <div class="empty-state">
                        <span>‚≠ê</span>
                        <p>Your watchlist is empty. Add stocks to monitor.</p>
                    </div>
                </div>

                <!-- Add to Watchlist Modal -->
                <div class="modal hidden" id="addWatchlistModal">
                    <div class="modal-content">
                        <h3>Add Stock to Watchlist</h3>
                        <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                            üí° Leave target/stoploss empty for auto-calculated values based on volatility analysis
                        </p>
                        <form id="addWatchlistForm">
                            <div class="form-group">
                                <label>Stock Symbol</label>
                                <div class="autocomplete-wrapper" style="position: relative;">
                                    <input type="text" id="watchlistSymbol"
                                        placeholder="Type to search... e.g., Reliance, TCS" autocomplete="off" required>
                                    <div id="stockSuggestions" class="autocomplete-dropdown"
                                        style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: var(--radius-sm); max-height: 250px; overflow-y: auto; z-index: 1000; box-shadow: 0 8px 24px rgba(0,0,0,0.3);">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Target Price <span
                                        style="color: var(--text-muted); font-weight: 400;">(auto-calculated if
                                        empty)</span></label>
                                <input type="number" id="watchlistTarget"
                                    placeholder="Auto-calculated based on analysis" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Stop Loss (optional)</label>
                                <input type="number" id="watchlistStopLoss" placeholder="e.g., 2200" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Notes (optional)</label>
                                <textarea id="watchlistNotes" rows="2" placeholder="Your analysis notes..."></textarea>
                            </div>
                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" id="cancelWatchlist">Cancel</button>
                                <button type="submit" class="btn btn-primary">Add to Watchlist</button>
                            </div>
                        </form>
                    </div>
                </div>

            </section>

            <!-- Messages Section -->
            <section class="section hidden" id="messages-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üì° Telegram Signals</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                        <div class="search-box">
                            <input type="text" id="messageSearch" placeholder="Search signals...">
                        </div>
                    </div>
                    <div class="header-filter-group">
                        <div class="time-shortcuts">
                            <button class="shortcut-btn" data-shortcut="last_hour">1H</button>
                            <button class="shortcut-btn" data-shortcut="today">Today</button>
                            <button class="shortcut-btn active" data-shortcut="last_day">24H</button>
                            <button class="shortcut-btn" data-shortcut="last_week">Week</button>
                            <button class="shortcut-btn" data-shortcut="all">All</button>
                        </div>
                    </div>
                </div>
                <div class="messages-list" id="messagesList">
                    <div class="empty-state">
                        <span>üí¨</span>
                        <p>No messages yet. Add sources and fetch messages.</p>
                    </div>
                </div>
            </section>

            <!-- News Section -->
            <section class="section hidden" id="news-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üß† Market Mood & Consensus</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                    </div>
                    <div class="header-filter-group">
                        <div class="time-shortcuts">
                            <button class="shortcut-btn" data-shortcut="last_hour">1H</button>
                            <button class="shortcut-btn" data-shortcut="today">Today</button>
                            <button class="shortcut-btn active" data-shortcut="last_day">24H</button>
                            <button class="shortcut-btn" data-shortcut="last_week">Week</button>
                            <button class="shortcut-btn" data-shortcut="all">All</button>
                        </div>
                    </div>
                </div>
                <div class="news-list" id="newsList">
                    <div class="empty-state">
                        <span>üì∞</span>
                        <p>No news articles. Click "Fetch News" to load latest news.</p>
                    </div>
                </div>
            </section>



            <!-- All Star Picks Section (Dedicated Page) -->
            <section class="section hidden" id="allstar-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>‚≠ê All Star Picks - Today's Top 10</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                    </div>
                    <div id="allstarTimerPage" class="refresh-timer">Loading...</div>
                </div>
                <div class="disclaimer" style="margin-bottom: 16px;">
                    ‚ö†Ô∏è <strong>Disclaimer:</strong> These picks are AI-generated based on news and Telegram signal
                    analysis.
                    This is NOT financial advice. Always do your own research.
                </div>
                <div class="allstar-container">
                    <div class="allstar-picks" id="allstarPicksPage">
                        <div class="empty-state"><span class="loading"></span>
                            <p>Loading All Star picks...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Stock Screener Section (Enhanced) -->
            <section class="section hidden" id="screener-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üìã Stock Screener</h3>
                        <span class="screen-count" id="screenCount">50+ Screens</span>
                        <button class="btn btn-secondary" id="openGlossaryBtn"
                            style="margin-left: 12px; font-size: 12px; padding: 6px 14px;">üìñ Learn Indicators</button>
                    </div>
                    <button class="btn btn-primary" id="runConsolidatedBtn">üî• Scan All Screens</button>
                </div>

                <!-- Indicator Glossary Modal -->
                <div class="modal hidden" id="glossaryModal">
                    <div class="modal-content" style="max-width: 680px; max-height: 85vh; overflow-y: auto;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0;">üìñ Stock Market Indicator Guide</h3>
                            <button class="btn btn-secondary" id="closeGlossaryBtn"
                                style="font-size: 18px; padding: 4px 12px;">‚úï</button>
                        </div>
                        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 20px; line-height: 1.5;">
                            New to stock markets? These are the most important numbers to understand before investing.
                            <strong>Hover over any colored metric</strong> in screener results to see its explanation.
                        </p>
                        <div id="glossaryContent" style="display: grid; gap: 16px;">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Strategy Recommendation Banner -->
                <div class="screener-strategy-banner" id="strategyBanner">
                    <div class="strategy-header">
                        <span class="strategy-icon">üí°</span>
                        <h4>Strategic Recommendation for Fresh Capital</h4>
                    </div>
                    <p class="strategy-summary">For deploying fresh capital, focus on <strong>PEG Ratio &lt; 1</strong>
                        (Value) or <strong>GARP</strong> (Growth). These screens filter for companies growing fast but
                        not overpriced by the market.</p>
                    <div class="strategy-rationale">
                        <span class="rationale-label">Why?</span>
                        <span>Pure "Value" screens often catch declining businesses. Pure "Growth" screens often catch
                            overpriced stocks. PEG and GARP find the sweet spot.</span>
                    </div>
                </div>

                <!-- Category Filter Tabs -->
                <div class="screener-category-tabs" id="screenerCategoryTabs"
                    style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;">
                    <button class="category-tab-btn active" data-category="all">All</button>
                    <button class="category-tab-btn" data-category="Value">üí∞ Value</button>
                    <button class="category-tab-btn" data-category="Growth">üìà Growth</button>
                    <button class="category-tab-btn" data-category="Quality">üíé Quality</button>
                    <button class="category-tab-btn" data-category="Technical">üìä Technical</button>
                    <button class="category-tab-btn" data-category="Thematic">üèõÔ∏è Thematic</button>
                    <button class="category-tab-btn" data-category="Safety">üõ°Ô∏è Safety</button>
                    <button class="category-tab-btn beginner-filter" data-category="beginner">üå± Beginner
                        Friendly</button>
                </div>

                <!-- View Toggle -->
                <div class="screener-view-toggle">
                    <button class="view-toggle-btn active" data-view="browse">üìö Browse Screens</button>
                    <button class="view-toggle-btn" data-view="consolidated">üî• Consolidated Results</button>
                </div>

                <!-- Browse View with Dropdown -->
                <div class="screener-browse-view" id="screenerBrowseView">
                    <!-- Screen Selection Dropdown -->
                    <div class="screen-selector-container"
                        style="display: flex; gap: 16px; align-items: flex-start; margin-bottom: 24px;">
                        <div style="flex: 1; max-width: 400px;">
                            <label
                                style="display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Select
                                Screen</label>
                            <select id="screenDropdown" class="screen-dropdown"
                                style="width: 100%; padding: 12px 16px; font-size: 14px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer;">
                                <option value="">-- Choose a Screen --</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="runSelectedScreenBtn"
                            style="margin-top: 25px; padding: 12px 24px;" disabled>
                            ‚ñ∂Ô∏è Run Screen
                        </button>
                    </div>

                    <!-- Screen Info Display -->
                    <div class="screen-info-box hidden" id="screenInfoBox"
                        style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 1px solid var(--border-color);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                            <h4 id="screenInfoName" style="margin: 0; font-size: 18px; font-weight: 600;">Screen Name
                            </h4>
                            <span id="screenInfoCategory"
                                style="background: var(--accent-primary); color: #fff; padding: 4px 12px; border-radius: 6px; font-size: 11px; font-weight: 600;">Category</span>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <span
                                style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Definition</span>
                            <p id="screenInfoDefinition"
                                style="margin: 4px 0 0 0; color: var(--text-secondary); font-size: 14px;">--</p>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <span
                                style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Summary</span>
                            <p id="screenInfoSummary"
                                style="margin: 4px 0 0 0; color: var(--text-primary); font-size: 14px;">--</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 12px; color: var(--text-muted);">Fresh Entry Rating:</span>
                            <span id="screenInfoRating" style="color: #f59e0b;">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span>
                        </div>
                    </div>

                    <!-- Screen Results -->
                    <div class="screen-results-container" id="screenResultsContainer">
                        <div class="empty-state">
                            <span>üìã</span>
                            <p>Select a screen from the dropdown to see matching stocks</p>
                        </div>
                    </div>
                </div>

                <!-- Consolidated Results View (Hidden by default) -->
                <div class="screener-consolidated-view hidden" id="screenerConsolidatedView">
                    <div class="consolidated-header">
                        <h4>üî• Top Picks Across All Screens</h4>
                        <span class="consolidated-meta" id="consolidatedMeta">--</span>
                    </div>

                    <!-- Fresh Entry Picks -->
                    <div class="fresh-entry-section" id="freshEntrySection">
                        <h5>‚≠ê Recommended for Fresh Capital</h5>
                        <div class="fresh-entry-picks" id="freshEntryPicks">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- All Aggregated Picks -->
                    <div class="aggregated-picks-section">
                        <h5>üìã All Multi-Screen Matches</h5>
                        <div class="aggregated-picks-grid" id="aggregatedPicksGrid">
                            <div class="empty-state">
                                <span>üìã</span>
                                <p>Click "Scan All Screens" to analyze stocks across 50+ screens</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Individual Screen Results (Modal-like) -->
                <div class="screen-detail-panel hidden" id="screenDetailPanel">
                    <div class="screen-detail-header">
                        <button class="back-btn" id="backToScreensBtn">‚Üê Back</button>
                        <div class="screen-detail-info">
                            <h4 id="screenDetailName">Screen Name</h4>
                            <span class="match-count" id="screenDetailMatches">0 matches</span>
                        </div>
                    </div>
                    <div class="screen-definition-box" id="screenDefinitionBox">
                        <div class="definition-row">
                            <span class="def-label">Definition:</span>
                            <span id="screenDetailDefinition">--</span>
                        </div>
                        <div class="summary-row">
                            <span class="def-label">Summary:</span>
                            <span id="screenDetailSummary">--</span>
                        </div>
                    </div>
                    <div class="screener-results" id="screenerResults">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>


            <!-- All Screens Section (New Dedicated Tab) -->
            <section class="section hidden" id="allscreens-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üî• All Screens - Real-Time Multi-Screen Scan</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                    </div>
                    <button class="btn btn-primary" id="runAllScreensBtn">‚ö° Scan All 50+ Screens</button>
                </div>

                <div class="disclaimer"
                    style="margin-bottom: 16px; padding: 12px 16px; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px;">
                    ‚ö° <strong>Real-Time Data:</strong> This scan fetches live fundamentals from Yahoo Finance for all
                    NSE/BSE stocks. Takes ~30-60 seconds.
                </div>

                <!-- Scan Progress -->
                <div class="scan-progress hidden" id="allScreensScanProgress" style="margin-bottom: 24px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span id="allScreensProgressText"
                            style="font-size: 14px; color: var(--text-secondary);">Initializing scan...</span>
                        <span id="allScreensProgressPercent"
                            style="font-size: 14px; font-weight: 600; color: var(--accent-primary);">0%</span>
                    </div>
                    <div style="height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden;">
                        <div id="allScreensProgressBar"
                            style="height: 100%; width: 0%; background: var(--accent-gradient); transition: width 0.3s ease;">
                        </div>
                    </div>
                </div>

                <!-- Results Stats -->
                <div class="allscreens-stats hidden" id="allScreensStats"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div
                        style="background: var(--bg-secondary); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color); text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--accent-primary);"
                            id="allScreensStocksScanned">0</div>
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Stocks Scanned</div>
                    </div>
                    <div
                        style="background: var(--bg-secondary); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color); text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: #22c55e;" id="allScreensScreensRun">0
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Screens Executed</div>
                    </div>
                    <div
                        style="background: var(--bg-secondary); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color); text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: #f59e0b;" id="allScreensMatchingStocks">0
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Multi-Screen Matches
                        </div>
                    </div>
                    <div
                        style="background: var(--bg-secondary); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color); text-align: center;">
                        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Last Updated</div>
                        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);"
                            id="allScreensTimestamp">--</div>
                    </div>
                </div>

                <!-- Fresh Entry Recommendations -->
                <div class="allscreens-fresh-picks" id="allScreensFreshSection" style="margin-bottom: 32px;">
                    <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <span>‚≠ê Top Picks for Fresh Capital</span>
                        <span
                            style="font-size: 11px; background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 2px 8px; border-radius: 4px;">High
                            Confidence</span>
                    </h4>
                    <div id="allScreensFreshPicks" class="allscreens-picks-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px;">
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <span>‚≠ê</span>
                            <p>Click "Scan All 50+ Screens" to discover top picks</p>
                        </div>
                    </div>
                </div>

                <!-- All Aggregated Results -->
                <div class="allscreens-all-picks">
                    <h4 style="margin-bottom: 16px;">üìã All Multi-Screen Matches</h4>
                    <div id="allScreensAllPicks" class="allscreens-picks-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px;">
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <span>üìã</span>
                            <p>Stocks matching 2+ screens will appear here</p>
                        </div>
                    </div>
                </div>
            </section>


            <!-- Exit Tracker Section -->
            <section class="section hidden" id="exittracker-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üö™ Exit Tracker - Portfolio Analysis</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                    </div>
                </div>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div class="stat-card"
                        style="background: rgba(30,30,30,0.4); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Active Picks Tracked
                        </div>
                        <div id="exitActiveCount" style="font-size: 24px; font-weight: 600;">--</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Last 30 Days</div>
                    </div>
                    <div class="stat-card"
                        style="background: rgba(239,68,68,0.1); padding: 16px; border-radius: 12px; border: 1px solid rgba(239,68,68,0.3);">
                        <div style="font-size: 13px; color: #fca5a5; margin-bottom: 4px;">Sell Signals</div>
                        <div id="exitSellCount" style="font-size: 24px; font-weight: 600; color: #ef4444;">--</div>
                        <div style="font-size: 11px; color: #fca5a5; margin-top: 4px;">Action Required</div>
                    </div>
                </div>

                <div class="allstar-container">
                    <div class="allstar-picks" id="exitTrackerPicks">
                        <div class="empty-state"><span class="loading"></span>
                            <p>Analyzing historical picks...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Research Console Section -->
            <section class="section hidden" id="research-section"
                style="height: calc(100vh - 80px); display: flex; flex-direction: column; overflow: hidden;">
                <div class="section-header" style="flex-shrink: 0;">
                    <div class="header-main-group">
                        <h3>üî¨ Research Console</h3>
                        <p style="color: var(--text-muted); margin: 4px 0 0 0; font-size: 13px;">Deep dive analysis and
                            expert insights</p>
                    </div>
                    <div class="research-search" style="display: flex; gap: 12px; align-items: center;">
                        <input type="text" class="research-search-input" id="researchSearchInput"
                            placeholder="Enter stock symbol (e.g., RELIANCE)"
                            style="padding: 10px 16px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); min-width: 280px;">
                        <button class="btn btn-primary" id="researchBtn">Analyze</button>
                    </div>
                </div>

                <!-- Scrollable Research Content -->
                <div class="research-console hidden" id="researchConsole"
                    style="flex: 1; overflow-y: auto; padding: 24px 0; scrollbar-width: thin;">
                    <!-- Stock Header Card -->
                    <div
                        style="background: var(--bg-secondary); border-radius: 12px; padding: 20px 24px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 4px;">
                                        <h2 id="researchSymbol"
                                            style="margin: 0; font-size: 28px; font-weight: 800; letter-spacing: -0.5px;">
                                            RELIANCE</h2>
                                        <span class="sector-badge" id="researchSector"
                                            style="background: var(--accent-gradient); padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; color: #fff;">Energy</span>
                                    </div>
                                    <div id="researchName" style="color: var(--text-muted); font-size: 14px;">Reliance
                                        Industries Ltd</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div id="researchPrice" style="font-size: 28px; font-weight: 700;">‚Çπ2,456.00</div>
                                <div id="researchChange" style="font-size: 15px; font-weight: 600; color: #22c55e;">
                                    +1.25%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Price Chart Card - FIRST -->
                    <div
                        style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                        <h4
                            style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 14px;">
                            <span class="material-icons" style="font-size: 18px;">show_chart</span> Price Chart (30
                            Days)
                        </h4>
                        <div style="height: 200px; position: relative;">
                            <canvas id="researchPriceChart"></canvas>
                        </div>
                    </div>

                    <!-- Expert & Key Fundamentals Grid - BELOW CHART -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <!-- Expert Consensus Card -->
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color);">
                            <h4
                                style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 14px;">
                                <span class="material-icons" style="font-size: 18px;">speed</span> Expert Consensus
                            </h4>
                            <div style="display: flex; align-items: center; gap: 24px;">
                                <div
                                    style="position: relative; width: 140px; height: 70px; overflow: hidden; flex-shrink: 0;">
                                    <div id="gaugeArc"
                                        style="width: 140px; height: 140px; border-radius: 50%; background: conic-gradient(from 180deg, #ef4444 0deg, #f59e0b 90deg, #22c55e 180deg, transparent 180deg);">
                                    </div>
                                    <div
                                        style="position: absolute; bottom: 0; left: 8px; width: 124px; height: 124px; background: var(--bg-secondary); border-radius: 50%;">
                                    </div>
                                    <div id="gaugeNeedle"
                                        style="position: absolute; bottom: 0; left: 70px; width: 3px; height: 60px; background: var(--text-primary); transform-origin: bottom center; transform: rotate(-90deg); transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);">
                                    </div>
                                    <div
                                        style="position: absolute; bottom: -4px; left: 66px; width: 8px; height: 8px; background: var(--text-primary); border-radius: 50%;">
                                    </div>
                                    <div id="gaugeScore"
                                        style="position: absolute; bottom: 0; left: 0; right: 0; text-align: center; font-size: 20px; font-weight: 800;">
                                        75</div>
                                </div>
                                <div style="flex: 1; min-width: 0;">
                                    <div id="gaugeSignal"
                                        style="font-size: 20px; font-weight: 700; color: #22c55e; margin-bottom: 6px;">
                                        STRONG BUY</div>
                                    <p style="color: var(--text-muted); font-size: 12px; margin: 0; line-height: 1.4;">
                                        Based on <strong id="gaugeSignalSource">AI Analysis</strong> showing positive
                                        momentum and strong fundamentals.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Key Fundamentals Card -->
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color);">
                            <h4
                                style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 14px;">
                                <span class="material-icons" style="font-size: 18px;">analytics</span> Key Fundamentals
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px;">
                                    <div
                                        style="color: var(--text-muted); font-size: 11px; margin-bottom: 4px; text-transform: uppercase;">
                                        P/E Ratio</div>
                                    <div id="statPE"
                                        style="font-weight: 700; font-size: 18px; color: var(--text-primary);">--</div>
                                </div>
                                <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px;">
                                    <div
                                        style="color: var(--text-muted); font-size: 11px; margin-bottom: 4px; text-transform: uppercase;">
                                        P/B Ratio</div>
                                    <div id="statPB"
                                        style="font-weight: 700; font-size: 18px; color: var(--text-primary);">--</div>
                                </div>
                                <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px;">
                                    <div
                                        style="color: var(--text-muted); font-size: 11px; margin-bottom: 4px; text-transform: uppercase;">
                                        ROE</div>
                                    <div id="statROE"
                                        style="font-weight: 700; font-size: 18px; color: var(--text-primary);">--</div>
                                </div>
                                <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px;">
                                    <div
                                        style="color: var(--text-muted); font-size: 11px; margin-bottom: 4px; text-transform: uppercase;">
                                        Div Yield</div>
                                    <div id="statDiv"
                                        style="font-weight: 700; font-size: 18px; color: var(--text-primary);">--</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Two Column: AI Insight + News - BELOW EXPERT & FUNDAMENTALS -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- AI Analyst Insight -->
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color);">
                            <h4
                                style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 14px;">
                                <span class="material-icons"
                                    style="color: var(--accent-primary); font-size: 18px;">psychology</span> AI Analyst
                                Insight
                            </h4>
                            <div id="aiAnalystInsight"
                                style="font-size: 13px; line-height: 1.7; color: var(--text-primary); max-height: 250px; overflow-y: auto;">
                                Loading AI analysis...
                            </div>
                        </div>

                        <!-- Latest News -->
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color);">
                            <h4
                                style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 14px;">
                                <span class="material-icons" style="font-size: 18px;">article</span> Latest News
                            </h4>
                            <div id="researchNewsList" style="overflow-y: auto; max-height: 250px; padding-right: 8px;">
                                <div class="empty-state" style="padding: 20px 0; font-size: 13px;">No relevant news
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Stats Row -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 20px;">
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; border: 1px solid var(--border-color); text-align: center;">
                            <div
                                style="color: var(--text-muted); font-size: 11px; margin-bottom: 6px; text-transform: uppercase;">
                                52W High</div>
                            <div id="stat52WH" style="font-weight: 700; font-size: 16px; color: #22c55e;">--</div>
                        </div>
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; border: 1px solid var(--border-color); text-align: center;">
                            <div
                                style="color: var(--text-muted); font-size: 11px; margin-bottom: 6px; text-transform: uppercase;">
                                52W Low</div>
                            <div id="stat52WL" style="font-weight: 700; font-size: 16px; color: #ef4444;">--</div>
                        </div>
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; border: 1px solid var(--border-color); text-align: center;">
                            <div
                                style="color: var(--text-muted); font-size: 11px; margin-bottom: 6px; text-transform: uppercase;">
                                Market Cap</div>
                            <div id="statMCap" style="font-weight: 700; font-size: 16px; color: var(--text-primary);">--
                            </div>
                        </div>
                        <div
                            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; border: 1px solid var(--border-color); text-align: center;">
                            <div
                                style="color: var(--text-muted); font-size: 11px; margin-bottom: 6px; text-transform: uppercase;">
                                Volume</div>
                            <div id="statVolume" style="font-weight: 700; font-size: 16px; color: var(--text-primary);">
                                --</div>
                        </div>
                    </div>
                </div>

                <div class="empty-state" id="researchEmpty"
                    style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <span style="font-size: 48px; margin-bottom: 16px;">üî¨</span>
                    <p style="font-size: 18px; color: var(--text-muted);">Enter a stock symbol above to start research
                    </p>
                </div>
            </section>

            <!-- Sources Section -->
            <section class="section hidden" id="sources-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üì° Telegram Sources</h3>
                        <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                    </div>
                    <button class="btn btn-primary" id="addSourceBtn">+ Add Source</button>
                </div>

                <div class="sources-list" id="sourcesList">
                    <div class="empty-state">
                        <span>üì°</span>
                        <p>No sources configured. Add Telegram channels to monitor.</p>
                    </div>
                </div>

                <!-- Add Source Modal -->
                <div class="modal hidden" id="addSourceModal">
                    <div class="modal-content">
                        <h3>Add Telegram Source</h3>
                        <form id="addSourceForm">
                            <div class="form-group">
                                <label>Source Name</label>
                                <input type="text" id="sourceName" placeholder="e.g., Stock Tips Channel" required>
                            </div>
                            <div class="form-group">
                                <label>Channel Username</label>
                                <input type="text" id="channelUsername" placeholder="e.g., @stocktips" required>
                            </div>
                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" id="cancelAddSource">Cancel</button>
                                <button type="submit" class="btn btn-primary">Add Source</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="section hidden" id="settings-section">
                <div class="settings-grid">
                    <!-- System & AI Configuration -->
                    <div class="settings-card">
                        <h3>‚öôÔ∏è System Configuration</h3>
                        <div class="settings-row"
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color);">
                            <div>
                                <h4 style="margin-bottom: 4px;">System Monitoring</h4>
                                <p style="font-size: 13px; color: var(--text-secondary);">Enable background Telegram &
                                    News monitoring</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="systemToggle" checked>
                            </label>
                        </div>
                        <!-- AI Features section REMOVED as per user request -->
                    </div>

                    <!-- Telegram Auth -->
                    <div class="settings-card">
                        <h3>üì± Telegram Authentication</h3>

                        <!-- Connected Status (shown when connected) -->
                        <div id="telegramConnectedStatus" class="hidden"
                            style="padding: 16px; background: rgba(34,197,94,0.1); border-radius: 8px; margin-bottom: 16px; border: 1px solid rgba(34,197,94,0.3);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span
                                    style="display: inline-block; width: 12px; height: 12px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite;"></span>
                                <span style="font-weight: 600; color: #22c55e;">Telegram Connected</span>
                            </div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin: 0 0 12px 0;">Your Telegram
                                account is connected and monitoring channels for signals.</p>
                            <button class="btn btn-secondary" id="telegramSignOutBtn"
                                style="background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid rgba(239,68,68,0.3);">
                                Sign Out from Telegram
                            </button>
                        </div>

                        <!-- Auth Form (shown when not connected) -->
                        <div id="telegramAuth">
                            <div class="form-group">
                                <label>API ID</label>
                                <input type="text" id="apiId" placeholder="Your Telegram API ID">
                            </div>
                            <div class="form-group">
                                <label>API Hash</label>
                                <input type="password" id="apiHash" placeholder="Your Telegram API Hash">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="text" id="phoneNumber" placeholder="+91XXXXXXXXXX">
                            </div>
                            <button class="btn btn-primary" id="sendCodeBtn">Send Code</button>

                            <div class="verify-section hidden" id="verifySection">
                                <div class="form-group">
                                    <label>Verification Code</label>
                                    <input type="text" id="verifyCode" placeholder="Enter code from Telegram">
                                </div>
                                <button class="btn btn-primary" id="verifyCodeBtn">Verify</button>
                            </div>
                        </div>
                    </div>


                    <!-- Info -->
                    <div class="settings-card">
                        <h3>‚ÑπÔ∏è How to Get Telegram API Credentials</h3>
                        <ol>
                            <li>Go to <a href="https://my.telegram.org" target="_blank">my.telegram.org</a></li>
                            <li>Log in with your phone number</li>
                            <li>Click on "API Development Tools"</li>
                            <li>Create a new application</li>
                            <li>Copy your API ID and API Hash</li>
                        </ol>
                    </div>

                    <!-- Gemini AI Settings -->
                    <div class="settings-card">
                        <h3>ü§ñ Gemini AI Configuration</h3>

                        <!-- AI Toggle -->
                        <div class="form-group"
                            style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="aiEnabledToggle">
                                <span class="toggle-slider"></span>
                            </label>
                            <div>
                                <strong id="aiStatusText">AI Disabled</strong>
                                <p style="font-size: 12px; color: var(--text-muted); margin: 0;">Toggle to
                                    enable/disable Gemini AI across the system</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Gemini API Key</label>
                            <input type="password" id="geminiApiKey" placeholder="Enter your Gemini API key">
                            <small style="color: var(--text-muted);">Get your key from <a
                                    href="https://aistudio.google.com/app/apikey" target="_blank">Google AI
                                    Studio</a></small>
                        </div>
                        <div class="form-group">
                            <label>Model Name</label>
                            <select id="geminiModel">
                                <option value="gemini-3.0-flash">Gemini 3.0 Flash (Fastest)</option>
                                <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                                <option value="gemini-pro">Gemini Pro</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="saveGeminiBtn">Save Gemini Settings</button>
                        <span id="geminiSaveStatus" style="margin-left: 12px; color: var(--text-muted);"></span>
                    </div>
                </div>
            </section>

            <!-- Pattern Scout Section -->
            <section class="section hidden" id="patterns-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üîç Pattern Scout</h3>
                        <p style="color: var(--text-muted); margin: 4px 0 0 0; font-size: 13px;">Technical pattern
                            recognition ‚Äî find the best time to buy or sell</p>
                    </div>
                </div>

                <!-- Beginner Explainer -->
                <div class="quant-explainer-banner">
                    <div class="explainer-icon">üå±</div>
                    <div class="explainer-content">
                        <h4>What is Pattern Scout?</h4>
                        <p>Think of it like a <strong>weather report for stocks</strong>. Just like clouds predict rain,
                            certain price patterns predict whether a stock might go up or down. Pattern Scout checks 3
                            things for you:</p>
                        <div class="explainer-pills">
                            <span class="explainer-pill">üìä <strong>Relative Strength</strong> ‚Äî Is this stock beating
                                the market?</span>
                            <span class="explainer-pill">üìà <strong>Momentum (RSI)</strong> ‚Äî Is it overbought or
                                oversold?</span>
                            <span class="explainer-pill">üîÄ <strong>Trend (MACD)</strong> ‚Äî Is the trend changing
                                direction?</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Try Buttons -->
                <div style="margin-bottom: 16px;">
                    <span style="color: var(--text-muted); font-size: 12px; margin-right: 8px;">Quick try:</span>
                    <div class="quick-try-chips">
                        <button class="quick-chip"
                            onclick="document.getElementById('patternScoutInput').value='RELIANCE'; analyzePatterns('RELIANCE')">RELIANCE</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('patternScoutInput').value='TCS'; analyzePatterns('TCS')">TCS</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('patternScoutInput').value='INFY'; analyzePatterns('INFY')">INFY</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('patternScoutInput').value='HDFCBANK'; analyzePatterns('HDFCBANK')">HDFC
                            Bank</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('patternScoutInput').value='TATASTEEL'; analyzePatterns('TATASTEEL')">Tata
                            Steel</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('patternScoutInput').value='ITC'; analyzePatterns('ITC')">ITC</button>
                    </div>
                </div>

                <div class="search-bar" style="margin-bottom: 24px;">
                    <input type="text" id="patternScoutInput" placeholder="Enter stock symbol (e.g., TATASTEEL)">
                    <button class="btn btn-primary" id="patternScoutBtn">üîç Analyze Patterns</button>
                </div>
                <div id="patternScoutResults" class="empty-state">
                    <span style="font-size: 48px;">üìä</span>
                    <p>Pick a stock above or type a symbol to see its technical patterns</p>
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">üí° Tip: Start with a stock
                        you already own or follow</p>
                </div>
            </section>

            <!-- QVM Engine Section -->
            <section class="section hidden" id="qvm-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üìä QVM Engine</h3>
                        <p style="color: var(--text-muted); margin: 4px 0 0 0; font-size: 13px;">Quality ¬∑ Valuation ¬∑
                            Momentum ‚Äî the 3 pillars of smart investing</p>
                    </div>
                </div>

                <!-- Beginner Explainer -->
                <div class="quant-explainer-banner">
                    <div class="explainer-icon">üéØ</div>
                    <div class="explainer-content">
                        <h4>What is QVM?</h4>
                        <p>QVM checks every stock on <strong>3 simple questions</strong> and gives a score out of 10 for
                            each:</p>
                        <div class="explainer-pills">
                            <span class="explainer-pill">‚ú® <strong>Quality</strong> ‚Äî Is this a well-run company? (ROE,
                                low debt)</span>
                            <span class="explainer-pill">üí∞ <strong>Valuation</strong> ‚Äî Is the stock priced fairly?
                                (P/E, P/B ratios)</span>
                            <span class="explainer-pill">üöÄ <strong>Momentum</strong> ‚Äî Is the stock trending up? (Price
                                vs averages)</span>
                        </div>
                        <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">üí° A score above 70/100
                            overall means the stock is worth considering. Above 80 is excellent!</p>
                    </div>
                </div>

                <!-- Quick Try Buttons -->
                <div style="margin-bottom: 16px;">
                    <span style="color: var(--text-muted); font-size: 12px; margin-right: 8px;">Quick try:</span>
                    <div class="quick-try-chips">
                        <button class="quick-chip"
                            onclick="document.getElementById('qvmInput').value='RELIANCE'; analyzeQvm('RELIANCE')">RELIANCE</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('qvmInput').value='TCS'; analyzeQvm('TCS')">TCS</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('qvmInput').value='INFY'; analyzeQvm('INFY')">INFY</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('qvmInput').value='HDFCBANK'; analyzeQvm('HDFCBANK')">HDFC
                            Bank</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('qvmInput').value='BAJFINANCE'; analyzeQvm('BAJFINANCE')">Bajaj
                            Finance</button>
                        <button class="quick-chip"
                            onclick="document.getElementById('qvmInput').value='WIPRO'; analyzeQvm('WIPRO')">Wipro</button>
                    </div>
                </div>

                <div class="search-bar" style="margin-bottom: 24px;">
                    <input type="text" id="qvmInput" placeholder="Enter stock symbol (e.g., RELIANCE)">
                    <button class="btn btn-primary" id="qvmAnalyzeBtn">üìä Analyze QVM</button>
                </div>
                <div id="qvmResults" class="empty-state">
                    <span style="font-size: 48px;">üìà</span>
                    <p>Pick a stock above or type a symbol to get Quality, Valuation & Momentum scores</p>
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">üí° Tip: Compare 2-3 similar
                        companies to find the winner</p>
                </div>
            </section>

            <!-- Con-Call Analyst Section -->
            <section class="section hidden" id="concall-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üìÑ Con-Call Analyst</h3>
                        <p style="color: var(--text-muted); margin: 4px 0 0 0; font-size: 13px;">AI reads earnings calls
                            so you don't have to</p>
                    </div>
                </div>

                <!-- Beginner Explainer -->
                <div class="quant-explainer-banner">
                    <div class="explainer-icon">üìû</div>
                    <div class="explainer-content">
                        <h4>What is a Con-Call?</h4>
                        <p>Every quarter, company leaders hold a <strong>conference call</strong> (con-call) where they
                            discuss how the business is doing. These calls are goldmines of information but are 50-100
                            pages long! Our AI reads the whole thing and extracts:</p>
                        <div class="explainer-pills">
                            <span class="explainer-pill">üöÄ <strong>Growth Drivers</strong> ‚Äî What's going well for the
                                company</span>
                            <span class="explainer-pill">‚ö†Ô∏è <strong>Headwinds</strong> ‚Äî Problems or risks ahead</span>
                            <span class="explainer-pill">üîç <strong>Red Flags</strong> ‚Äî Signs that management might be
                                hiding bad news</span>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 16px;">
                    <!-- Upload Card -->
                    <div class="settings-card">
                        <h4>üì§ Upload Transcript</h4>
                        <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 13px;">Upload a con-call PDF
                            from BSE/NSE. AI will analyze it in 30-60 seconds.</p>
                        <div class="form-group">
                            <input type="file" id="concallFileInput" accept=".pdf" style="margin-bottom: 12px;">
                        </div>
                        <button class="btn btn-primary" id="concallAnalyzeBtn">üî¨ Analyze with AI</button>
                        <p id="concallStatus" style="color: var(--text-muted); margin-top: 8px; font-size: 12px;"></p>
                    </div>

                    <!-- Example / Demo Card -->
                    <div class="settings-card" style="border-color: rgba(139, 92, 246, 0.3);">
                        <h4>üëÄ See Example Analysis</h4>
                        <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 13px;">Not sure what to
                            expect? See a sample analysis of a real con-call to understand the output.</p>
                        <button class="btn btn-primary" onclick="showDemoConcallAnalysis()"
                            style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">üìã Show Sample
                            Analysis</button>
                        <p style="color: var(--text-muted); margin-top: 8px; font-size: 11px;">‚ú® No AI key required ‚Äî
                            uses pre-analyzed data</p>
                    </div>
                </div>
                <div id="concallResults" style="margin-top: 24px;"></div>
            </section>

            <!-- Market Mood Section -->
            <section class="section hidden" id="mood-section">
                <div class="section-header">
                    <div class="header-main-group">
                        <h3>üå°Ô∏è Market Mood</h3>
                        <p style="color: var(--text-muted); margin: 4px 0 0 0; font-size: 13px;">Fear & Greed Index ‚Äî
                            should you buy, hold, or wait?</p>
                    </div>
                    <button class="btn btn-icon-round refresh-btn" onclick="loadMarketMood()">üîÑ</button>
                </div>

                <!-- Beginner Explainer -->
                <div class="quant-explainer-banner">
                    <div class="explainer-icon">üß†</div>
                    <div class="explainer-content">
                        <h4>What is Market Mood?</h4>
                        <p>The market swings between <strong style="color: #ef4444;">Fear</strong> (everyone panic
                            sells) and <strong style="color: #22c55e;">Greed</strong> (everyone buys blindly). The
                            smartest strategy? <strong>Buy when others are fearful, be cautious when others are
                                greedy.</strong></p>
                        <div class="explainer-pills">
                            <span class="explainer-pill" style="border-color: rgba(239,68,68,0.3);">üò∞ <strong>0-25:
                                    Extreme Fear</strong> ‚Äî Great time to buy quality stocks at a discount</span>
                            <span class="explainer-pill" style="border-color: rgba(245,158,11,0.3);">üòê <strong>40-60:
                                    Neutral</strong> ‚Äî Market is balanced, follow fundamentals</span>
                            <span class="explainer-pill" style="border-color: rgba(34,197,94,0.3);">ü§ë <strong>75-100:
                                    Extreme Greed</strong> ‚Äî Be cautious, prices may be inflated</span>
                        </div>
                    </div>
                </div>

                <div id="marketMoodContent" class="empty-state">
                    <span class="loading"></span>
                    <p>Loading market mood data...</p>
                </div>
            </section>

            <!-- AI Assistant Section - Comprehensive Dashboard -->
            <section class="section hidden" id="ai-section">
                <div class="section-header">
                    <h3>ü§ñ AI Stock Assistant</h3>
                    <button class="btn btn-icon-round refresh-btn" onclick="refreshCurrentSection()">üîÑ</button>
                </div>

                <!-- AI Stats Row -->
                <div class="ai-stats-row"
                    style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div class="stat-card"
                        style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="material-icons" style="font-size: 32px; color: #22c55e;">trending_up</span>
                            <div>
                                <div id="aiBullishCount" style="font-size: 28px; font-weight: 700; color: #22c55e;">--
                                </div>
                                <div style="color: var(--text-muted); font-size: 12px;">Bullish Signals (24h)</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="material-icons" style="font-size: 32px; color: #ef4444;">trending_down</span>
                            <div>
                                <div id="aiBearishCount" style="font-size: 28px; font-weight: 700; color: #ef4444;">--
                                </div>
                                <div style="color: var(--text-muted); font-size: 12px;">Bearish Signals (24h)</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="material-icons" style="font-size: 32px; color: #f59e0b;">article</span>
                            <div>
                                <div id="aiNewsCount"
                                    style="font-size: 28px; font-weight: 700; color: var(--text-primary);">--</div>
                                <div style="color: var(--text-muted); font-size: 12px;">News Analyzed (24h)</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="material-icons" style="font-size: 32px; color: #6366f1;">chat</span>
                            <div>
                                <div id="aiTelegramCount"
                                    style="font-size: 28px; font-weight: 700; color: var(--text-primary);">--</div>
                                <div style="color: var(--text-muted); font-size: 12px;">Telegram Signals (24h)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Mood & Top Picks Row -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px; margin-bottom: 24px;">
                    <!-- Market Mood Card -->
                    <div class="market-mood-card"
                        style="background: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <h4 style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons">psychology</span>
                            AI Market Mood
                        </h4>
                        <div id="aiMarketMood" style="text-align: center; padding: 20px 0;">
                            <div id="moodEmoji" style="font-size: 64px; margin-bottom: 12px;">üìä</div>
                            <div id="moodLabel" style="font-size: 24px; font-weight: 600; color: var(--text-primary);">
                                Analyzing...</div>
                            <p id="moodDescription" style="color: var(--text-muted); margin-top: 8px; font-size: 13px;">
                                Loading market sentiment...</p>
                        </div>
                        <div id="moodMeter"
                            style="height: 8px; background: linear-gradient(to right, #ef4444, #f59e0b, #22c55e); border-radius: 4px; position: relative;">
                            <div id="moodIndicator"
                                style="position: absolute; top: -4px; left: 50%; width: 16px; height: 16px; background: white; border-radius: 50%; border: 2px solid var(--accent-primary); transform: translateX(-50%);">
                            </div>
                        </div>
                    </div>

                    <!-- AI Top Picks -->
                    <div class="ai-top-picks"
                        style="background: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <h4 style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons" style="color: #fbbf24;">star</span>
                            AI Top Stock Picks (Buy Now)
                        </h4>
                        <div id="aiTopPicksGrid"
                            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                            <div style="text-align: center; color: var(--text-muted); padding: 40px;">Loading
                                recommendations...</div>
                        </div>
                    </div>
                </div>

                <!-- Telegram Signals Analysis & Purchase Suggestions -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <!-- Recent Telegram Signals -->
                    <div class="telegram-signals-card"
                        style="background: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <h4 style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons" style="color: #6366f1;">telegram</span>
                            Recent Telegram Signals
                        </h4>
                        <div id="aiTelegramSignals" style="max-height: 300px; overflow-y: auto;">
                            <div style="text-align: center; color: var(--text-muted); padding: 40px;">Loading signals...
                            </div>
                        </div>
                    </div>

                    <!-- AI Purchase Suggestions -->
                    <div class="purchase-suggestions-card"
                        style="background: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <h4 style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons" style="color: #22c55e;">shopping_cart</span>
                            AI Purchase Suggestions
                        </h4>
                        <div id="aiPurchaseSuggestions" style="max-height: 300px; overflow-y: auto;">
                            <div style="text-align: center; color: var(--text-muted); padding: 40px;">Analyzing best
                                opportunities...</div>
                        </div>
                    </div>
                </div>

                <!-- Stock Analysis from News -->
                <div class="news-analysis-card"
                    style="background: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 24px;">
                    <h4 style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                        <span class="material-icons" style="color: #f59e0b;">analytics</span>
                        24h News & Stock Analysis
                    </h4>
                    <div id="aiNewsAnalysis" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div style="text-align: center; color: var(--text-muted); padding: 40px; grid-column: span 2;">
                            Loading news analysis...</div>
                    </div>
                </div>

                <!-- AI Chat (Compact) -->
                <div class="ai-chat-compact"
                    style="background: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color);">
                    <h4 style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                        <span class="material-icons" style="color: var(--accent-primary);">smart_toy</span>
                        Ask AI Assistant
                    </h4>
                    <div id="aiChatMessages"
                        style="background: var(--bg-tertiary); min-height: 150px; max-height: 250px; overflow-y: auto; padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                        <div class="ai-message incoming" style="display: flex; gap: 12px; margin-bottom: 12px;">
                            <span class="material-icons"
                                style="color: var(--accent-primary); font-size: 20px;">smart_toy</span>
                            <p
                                style="background: var(--bg-secondary); padding: 10px 14px; border-radius: 8px; margin: 0; font-size: 14px;">
                                Ask me anything about stocks, get analysis, or request specific recommendations!</p>
                        </div>
                    </div>
                    <!-- Example Query Chips -->
                    <div class="quick-try-chips" style="margin-bottom: 12px;" id="aiQueryChips">
                        <button class="quick-chip" onclick="fillAndSendAiChat('Is RELIANCE a good buy right now?')">Is
                            RELIANCE a good buy?</button>
                        <button class="quick-chip" onclick="fillAndSendAiChat('Best stocks under ‚Çπ500')">Best stocks
                            under ‚Çπ500</button>
                        <button class="quick-chip" onclick="fillAndSendAiChat('Compare TCS vs INFY')">Compare TCS vs
                            INFY</button>
                        <button class="quick-chip"
                            onclick="fillAndSendAiChat('Top dividend paying stocks in India')">Top dividend
                            stocks</button>
                        <button class="quick-chip" onclick="fillAndSendAiChat('Explain what P/E ratio means')">What is
                            P/E ratio?</button>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <input type="text" id="aiChatInput"
                            placeholder="e.g., Should I buy RELIANCE today? or Analyze TCS..."
                            style="flex: 1; padding: 12px 16px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary);"
                            onkeypress="if(event.key==='Enter') sendAiChat()">
                        <button class="btn btn-primary" onclick="sendAiChat()" style="padding: 12px 24px;">Send</button>
                    </div>
                </div>
            </section>

            <!-- Stock Detail Modal (Universal - accessible from any page) -->
            <div class="modal hidden" id="stockDetailModal">
                <div class="modal-content stock-detail-modal">
                    <div class="stock-detail-header">
                        <div class="stock-title-block">
                            <h3 id="stockDetailTitle">Loading...</h3>
                            <span class="stock-category-badge" id="stockCategoryBadge"></span>
                        </div>
                        <button type="button" class="modal-close-btn" id="closeStockDetail">√ó</button>
                    </div>

                    <div class="stock-detail-body">
                        <!-- Price Overview -->
                        <div class="stock-price-overview" id="stockPriceOverview">
                            <div class="current-price-block">
                                <span class="price-label">Current Price</span>
                                <span class="price-value" id="stockCurrentPrice">--</span>
                                <span class="price-change" id="stockPriceChange">--</span>
                            </div>
                            <div class="price-range">
                                <div><span>Day Low</span><strong id="stockDayLow">--</strong></div>
                                <div><span>Day High</span><strong id="stockDayHigh">--</strong></div>
                                <div><span>Prev Close</span><strong id="stockPrevClose">--</strong></div>
                            </div>
                        </div>

                        <!-- Target & Stop Loss -->
                        <div class="stock-targets" id="stockTargets">
                            <div class="target-card target">
                                <span class="target-label">üéØ Target</span>
                                <span class="target-value" id="stockTarget">--</span>
                                <span class="target-percent" id="stockTargetPercent">--</span>
                            </div>
                            <div class="target-card stoploss">
                                <span class="target-label">üõë Stop Loss</span>
                                <span class="target-value" id="stockStopLoss">--</span>
                                <span class="target-percent" id="stockSLPercent">--</span>
                            </div>
                        </div>

                        <!-- Price Chart -->
                        <div class="stock-chart-container">
                            <h4>üìà Price History (30 Days)</h4>
                            <canvas id="stockChart" height="150"></canvas>
                        </div>

                        <!-- Advanced Recommendation -->
                        <div class="stock-advanced-rec" id="stockAdvancedRec"
                            style="margin-bottom: 24px; padding: 16px; background: rgba(var(--accent-primary-rgb), 0.05); border-radius: 12px; border: 1px solid rgba(var(--accent-primary-rgb), 0.2);">
                            <h4 style="margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                                ü§ñ Expert AI Analysis
                                <span
                                    style="font-size: 11px; padding: 2px 6px; background: var(--bg-secondary); border-radius: 4px; color: var(--text-muted); font-weight: normal;">BETA</span>
                            </h4>
                            <div class="adv-rec-container">
                                <!-- AI Verdict Header -->
                                <div class="rec-header"
                                    style="text-align: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border-color);">
                                    <div id="recVerdict"
                                        style="font-size: 24px; font-weight: 800; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px;">
                                        --
                                    </div>
                                    <div class="signal-badge" id="recSignalBadge"
                                        style="display: inline-block; font-size: 14px; font-weight: 700; padding: 4px 12px; border-radius: 99px; background: var(--bg-secondary); margin-bottom: 12px;">
                                        --</div>

                                    <div class="confidence-meter"
                                        style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                        <span style="font-size: 12px; color: var(--text-secondary);">AI
                                            Confidence</span>
                                        <div class="meter-bar"
                                            style="width: 60px; height: 6px; background: var(--bg-secondary); border-radius: 3px; overflow: hidden;">
                                            <div class="fill" id="recConfidenceFill"
                                                style="height: 100%; width: 0%; background: var(--accent-primary); transition: width 0.5s ease;">
                                            </div>
                                        </div>
                                        <span id="recConfidenceValue"
                                            style="font-size: 12px; font-weight: 600;">0%</span>
                                    </div>
                                </div>

                                <!-- Analysis Tabs -->
                                <div class="analysis-tabs"
                                    style="display: flex; gap: 2px; background: rgba(255,255,255,0.05); padding: 2px; border-radius: 8px; margin-bottom: 16px;">
                                    <button class="tab-btn active" onclick="switchAnalysisTab('rationale')"
                                        style="flex:1; padding: 8px; border: none; background: var(--bg-card); border-radius: 6px; color: var(--text-primary); font-size: 12px; font-weight: 600; cursor: pointer;">Rationale</button>
                                    <button class="tab-btn" onclick="switchAnalysisTab('bull_case')"
                                        style="flex:1; padding: 8px; border: none; background: transparent; border-radius: 6px; color: var(--text-secondary); font-size: 12px; font-weight: 600; cursor: pointer;">Bull
                                        Case üêÇ</button>
                                    <button class="tab-btn" onclick="switchAnalysisTab('bear_case')"
                                        style="flex:1; padding: 8px; border: none; background: transparent; border-radius: 6px; color: var(--text-secondary); font-size: 12px; font-weight: 600; cursor: pointer;">Bear
                                        Case üêª</button>
                                    <button class="tab-btn" onclick="switchAnalysisTab('risk')"
                                        style="flex:1; padding: 8px; border: none; background: transparent; border-radius: 6px; color: var(--text-secondary); font-size: 12px; font-weight: 600; cursor: pointer;">Risk
                                        ‚ö†Ô∏è</button>
                                </div>

                                <div id="tabContentRationale" class="tab-content" style="display: block;">
                                    <div class="rec-rationale" id="recRationale"
                                        style="font-size: 14px; line-height: 1.6; color: var(--text-primary); margin-bottom: 20px; font-style: italic; background: rgba(255,255,255,0.02); padding: 12px; border-radius: 8px; border-left: 3px solid var(--accent-primary);">
                                    </div>

                                    <!-- Technical Indicators Grid (New) -->
                                    <div id="recTechnicalGrid"
                                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 16px;">
                                    </div>
                                </div>

                                <div id="tabContentBull" class="tab-content" style="display: none;">
                                    <ul id="recBullList" style="list-style: none; margin-bottom: 20px; padding: 0;">
                                    </ul>
                                </div>

                                <div id="tabContentBear" class="tab-content" style="display: none;">
                                    <ul id="recBearList" style="list-style: none; margin-bottom: 20px; padding: 0;">
                                    </ul>
                                </div>

                                <div id="tabContentRisk" class="tab-content" style="display: none;">
                                    <div id="recRiskMetrics"
                                        style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;"></div>
                                </div>

                                <div id="tabContentBear" class="tab-content" style="display: none;">
                                    <ul id="recBearList" style="list-style: none; margin-bottom: 20px; padding: 0;">
                                    </ul>
                                </div>

                                <!-- Factor Ratings -->
                                <div class="rec-factors-grid"
                                    style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
                                    <div class="factor-card" style="text-align: center;">
                                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            VALUE</div>
                                        <div class="factor-bar"
                                            style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; margin-bottom: 4px;">
                                            <div id="factorFillValue"
                                                style="height: 100%; width: 0%; background: var(--accent-primary);">
                                            </div>
                                        </div>
                                        <div id="factorScoreValue" style="font-size: 12px; font-weight: 700;">--</div>
                                    </div>
                                    <div class="factor-card" style="text-align: center;">
                                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            GROWTH</div>
                                        <div class="factor-bar"
                                            style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; margin-bottom: 4px;">
                                            <div id="factorFillGrowth"
                                                style="height: 100%; width: 0%; background: var(--success);"></div>
                                        </div>
                                        <div id="factorScoreGrowth" style="font-size: 12px; font-weight: 700;">--</div>
                                    </div>
                                    <div class="factor-card" style="text-align: center;">
                                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            SAFETY</div>
                                        <div class="factor-bar"
                                            style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; margin-bottom: 4px;">
                                            <div id="factorFillSafety"
                                                style="height: 100%; width: 0%; background: var(--info);"></div>
                                        </div>
                                        <div id="factorScoreSafety" style="font-size: 12px; font-weight: 700;">--</div>
                                    </div>
                                    <div class="factor-card" style="text-align: center;">
                                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            QUALITY</div>
                                        <div class="factor-bar"
                                            style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; margin-bottom: 4px;">
                                            <div id="factorFillQuality"
                                                style="height: 100%; width: 0%; background: var(--accent-secondary);">
                                            </div>
                                        </div>
                                        <div id="factorScoreQuality" style="font-size: 12px; font-weight: 700;">--</div>
                                    </div>
                                </div>

                                <div class="rec-factors" style="margin-bottom: 20px;">
                                    <h5
                                        style="font-size: 12px; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 8px;">
                                        Key Drivers</h5>
                                    <div class="factors-list" id="recFactorsList"
                                        style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                                </div>

                                <div class="rec-timeframes"
                                    style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                    <div class="tf-card" id="tfIntraday"
                                        style="background: var(--bg-card); padding: 8px; border-radius: 8px; text-align: center; border: 1px solid var(--border-color);">
                                        <div class="tf-label"
                                            style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            INTRADAY</div>
                                        <div class="tf-signal" style="font-weight: 700; font-size: 13px;">--</div>
                                    </div>
                                    <div class="tf-card" id="tfShortTerm"
                                        style="background: var(--bg-card); padding: 8px; border-radius: 8px; text-align: center; border: 1px solid var(--border-color);">
                                        <div class="tf-label"
                                            style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            SHORT TERM</div>
                                        <div class="tf-signal" style="font-weight: 700; font-size: 13px;">--</div>
                                    </div>
                                    <div class="tf-card" id="tfMidTerm"
                                        style="background: var(--bg-card); padding: 8px; border-radius: 8px; text-align: center; border: 1px solid var(--border-color);">
                                        <div class="tf-label"
                                            style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            MID TERM</div>
                                        <div class="tf-signal" style="font-weight: 700; font-size: 13px;">--</div>
                                    </div>
                                    <div class="tf-card" id="tfLongTerm"
                                        style="background: var(--bg-card); padding: 8px; border-radius: 8px; text-align: center; border: 1px solid var(--border-color);">
                                        <div class="tf-label"
                                            style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                                            LONG TERM</div>
                                        <div class="tf-signal" style="font-weight: 700; font-size: 13px;">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Key Ratios -->
                        <div class="stock-ratios">
                            <h4>üìä Key Ratios</h4>
                            <div class="ratios-grid" id="stockRatiosGrid">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- Recommendations -->
                        <div class="stock-recommendations" id="stockRecsSection">
                            <h4>üí° AI Recommendations</h4>
                            <div class="recs-list" id="stockRecsList"></div>
                        </div>

                        <!-- External Links -->
                        <div class="stock-external-links">
                            <h4>üîó Research Links</h4>
                            <div class="links-row" id="stockExternalLinks"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- AI Chatbot REMOVED as per user request -->

    <script src="/static/app.js"></script>
</body>

</html>